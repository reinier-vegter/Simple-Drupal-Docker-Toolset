<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Simple Drupal Docker Toolset : Drupal development toolset, quick, easy, no complex configs.">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Simple Drupal Docker Toolset</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/reinier-vegter/Simple-Drupal-Docker-Toolset">View on GitHub</a>

          <h1 id="project_title">Simple Drupal Docker Toolset</h1>
          <h2 id="project_tagline">Drupal development toolset, quick, easy, no complex configs.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/reinier-vegter/Simple-Drupal-Docker-Toolset/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/reinier-vegter/Simple-Drupal-Docker-Toolset/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a id="drupal-development-toolkit-based-on-docker" class="anchor" href="#drupal-development-toolkit-based-on-docker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Drupal development toolkit based on Docker</h2>

<p>Visit at Github Pages: <a href="http://reinier-vegter.github.io/Simple-Drupal-Docker-Toolset/">http://reinier-vegter.github.io/Simple-Drupal-Docker-Toolset/</a></p>

<p>With this toolset, you can install docker and easily fire up any existing Drupal (or php) webroot in 2 seconds.</p>

<ul>
<li>drupal 6,7,8 (or basically any PHP app by disabling the drupal check, NO_DRUPAL_CHECK=1)</li>
<li>SSL support</li>
<li>PHP 5.4, 5.6 (default), 7.0</li>
<li>Apache 2.2</li>
<li>one MySQL container for all projects (data saved in your local home-folder).</li>
<li>one Drupal container + hostname per project</li>
<li>Solr 4 container for each project, data storage in project folder, and auto-using of search_api_solr config files.</li>
<li>mailsink that collects al emails sent through sendmail (/tmp/d7-docker-mailsink on host)</li>
<li>varnish out-of-the-box (See 'CUSTOM PROJECT CONFIGURATION')</li>
<li>memcache</li>
<li>custom mounts, dns entries, solr-config, local hostnames</li>
<li>XHProf / XHGui</li>
</ul>

<hr>

<h3>
<a id="credits" class="anchor" href="#credits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Credits</h3>

<p>Simple Drupal Docker Toolset is sponsored and supported by <a href="http://www.finalist.nl/">Finalist B.V.</a></p>

<hr>

<h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>INSTALLATION</h3>

<h4>
<a id="get-this-toolset-first" class="anchor" href="#get-this-toolset-first" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get this toolset first</h4>

<p>Clone git repository somewehere in local folder, or download archive package, and unpack.</p>

<pre><code>git clone https://github.com/reinier-vegter/Simple-Drupal-Docker-Toolset.git ~/docker-drupal
</code></pre>

<h4>
<a id="gnulinux-distro" class="anchor" href="#gnulinux-distro" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GNU/Linux distro:</h4>

<ul>
<li>Install docker:

<ul>
<li><code>curl -sSL https://get.docker.com/ | sh</code></li>
</ul>
</li>
<li>Add yourself to docker group:

<ul>
<li><code>sudo usermod -aG docker [YOUR USER]</code></li>
</ul>
</li>
<li>Then, logout your system and login again</li>
<li>Run <code>bin/install.sh</code> to symlink all needed scripts to your bin folder.</li>
<li>Give write access to yourself on hosts file:

<ul>
<li><code>sudo chown root:$(whoami) /etc/hosts</code></li>
<li><code>sudo chmod 664 /etc/hosts</code></li>
</ul>
</li>
</ul>

<h4>
<a id="osx" class="anchor" href="#osx" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>OSX</h4>

<p>From: <a href="https://docs.docker.com/installation/mac/">https://docs.docker.com/installation/mac/</a></p>

<ul>
<li>Install toolbox from <a href="https://www.docker.com/toolbox">https://www.docker.com/toolbox</a>
</li>
<li>Open Docker Quickstart Terminal and close when finished</li>
<li>Open VirtualBox and assign more CPU's to the 'default' VM, as it will be quite slow by default (only 1 CPU)</li>
<li>Add your user to 'wheel' group, in terminal (so the toolset can add hostname-entries to your hosts file):

<ul>
<li><code>sudo dseditgroup -o edit -a $(whoami) -t user wheel</code></li>
</ul>
</li>
<li>Give wheel-group write access to hosts file, in terminal:

<ul>
<li><code>sudo chmod 664 /etc/hosts</code></li>
</ul>
</li>
<li>Run the following command to symlink all needed scripts to your bin folder.

<ul>
<li><code>sudo bin/install.sh</code></li>
</ul>
</li>
</ul>

<h3>
<a id="update-toolset" class="anchor" href="#update-toolset" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>UPDATE TOOLSET</h3>

<p>Do a git pull to fetch the latest master-branch for this toolset.
  Then, run <code>bin/install.sh</code> again.</p>

<hr>

<h3>
<a id="available-commands" class="anchor" href="#available-commands" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AVAILABLE COMMANDS</h3>

<pre><code>    - d7-start                        : start drupal 7 container from project folder
    - d7-stop                         : stop container for 'this' project
    - d7-mysql-start                  : start mysql container (triggered by d7-start)
    - d7-mysql-stop                   : stop mysql container
    - d7-solr4-start                  : start solr4 container (triggered by d7-start)
    - d7-solr4-stop                   : stop solr4 container
    - d7-status                       : shows all docker containers (running and stopped)
    - d7-stop-all                     : stops all drupal toolset related containers
    - d7-update-images                : Will pull updated images from repository.
                                        You should run this every once in a while.
    - d7-cleanup                      : Cleanup (stop + remove) all drupal 7 containers.
                                        They are disposable, and usually removed immediately
                                        when you stop a d7 container.
    - d7-logs [num|all]               : Tail all apache logs.
                                        Argument sets number of lines to print, before following.
                                          (Should be integer, or 'all')
                                        Starts 'docker logs --tail=[num] -f [container]'
    - d7-ssh [container (optional)]   : Open shell (bash) in container. Defaults to container in current webroot folder.
    - d7-drush [drush arguments]      : This runs drush with supplied arguments, in the webroot, as web user.
                                        You can alias this if you'd make this transparent on your system, by adding
                                        alias drush="d7-drush"   to your .bashrc file (~/.bashrc).
    - d7-help                         : Show README
</code></pre>

<h3>
<a id="commands-for-toolset-development" class="anchor" href="#commands-for-toolset-development" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Commands for toolset development</h3>

<pre><code>    - d7-build-docker-image           : Build / rebuild docker images. This replaces images that are downloaded from dockerhub.
</code></pre>

<hr>

<h3>
<a id="quick-start" class="anchor" href="#quick-start" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>QUICK START</h3>

<p>To start your project, go to the project folder, and run 'd7-start'
Note that settings.php must contain the mysql-host 'mysql-docker.dev',
and that solr is reachable at localhost:8983 from each drupal container.</p>

<p>Building docker images is done the first time you use them ("d7-start"), and can take a while.</p>

<h3>
<a id="common-hostnames" class="anchor" href="#common-hostnames" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Common hostnames</h3>

<ul>
<li>mysql-docker.dev                :  Location of mysql server, reachable from host and container</li>
<li>dockerhost                      :  Location of your laptop / server. Reachable from container.
                                  To make it reachable from your laptop/server,
                                  just add '127.0.0.1 dockerhost' to /etc/hosts .</li>
</ul>

<hr>

<h3>
<a id="custom-project-configuration" class="anchor" href="#custom-project-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>CUSTOM PROJECT CONFIGURATION</h3>

<p>Custom docker stuff per project:
Add file .d7-docker.conf to your project folder.</p>

<p><strong>Be aware that any bash code in this file is actually executed</strong></p>

<p>Example content of file:</p>

<pre><code>    # Add dependency container.
    # Format: [container name]:[start-script/command]
    # CUST_DEPENDENCIES=(
    #   "docker.mysql:${mydir}/d7-mysql-start.sh"
    #   "docker.solr4:${mydir}/d7-solr4-start.sh"
    # )
    #
    # Add custom link between containers.
    # Format: [dependency container name]:[hostname in 'this' container, mapped to dependency]
    # CUST_LINK=(
    #   "docker.mysql:mysql-docker.dev"
    #   "docker.solr4:solr4-docker.dev"
    # )
    #
    # Mount extra volumes in container.
    # Format: [local folder]:[folder in container]
    # CUST_VOL="/opt/simplesamlphp:/opt/simplesamlphp1"
    #
    # Give container extra hostnames.
    # CUST_HOSTNAMES=(
    #   "dev.my-favorite-hostname.com"
    # )
    #
    # Provide DNS (hosts-file) entries to container, so container can resolve it.
    # For example usefull if you're having trouble to get docker to communicate through host-system VPN.
    # CUST_DNS=(
    #    www.google-dns.com:8.8.4.4
    # )
    #
    # Do not check if this is actually Drupal. Usable for 'other' php apps to be ran in
    # a D7 container.
    # NO_DRUPAL_CHECK=1
    #
    # Enable Varnish cache engine
    # VARNISH_ENABLE=1
    # Note: This will run Varnish on port 80 (so Drupal can talk to varnish on 127.0.0.1:80)
    # and Apache on port 90.
    # Note: To purge a page, let Drupal call URL's on varnish with the PURGE-method (like GET, but
    # make it PURGE...). The purge and expire modules are a very useful combination to do this.
    #
    # Enable memcache daemon
    # MEMCACHED_ENABLE=1
    #
    # Enable XHGui
    # XHGUI_ENABLE=1
    #
    # Set PHP version to use
    # PHP_VERSION=5.4
    # Supported versions: 5.4, 5.6, 7.0.
    # Defaults to 5.6
    #
    # Custom location for Solr config files.
    # Note that the toolset finds 'search_api_solr/solr-conf/4.x' automatically.
    # Only use this if you use some other module, or schema files of your own.
    # SOLR_CONF_OVERRIDES='sites/all/modules/contrib/search_api_solr/solr-conf/4.x'
    #
</code></pre>

<hr>

<h3>
<a id="use-of-xdebug" class="anchor" href="#use-of-xdebug" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Use of XDebug</h3>

<p>XDebug is installed in the container.
To use it with php-storm</p>

<ul>
<li>make sure to just enable the listener (no server config needed, defaults work fine) in order to start debugging.
<img src="images/listener.png" alt="PHPStorm XDebug listener">
</li>
<li>Generate the bookmarklets at <a href="https://www.jetbrains.com/phpstorm/marklets/">https://www.jetbrains.com/phpstorm/marklets/</a> , to start/stop the debugger.</li>
</ul>

<p>That's all...</p>

<p>To use XDebug profiler, just add a 'profiler' folder in your project.
It will generate cachegrind files that you can open with KCacheGrind or any other tool.
See <a href="http://www.xdebug.org/docs/profiler">http://www.xdebug.org/docs/profiler</a></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Simple Drupal Docker Toolset maintained by <a href="https://github.com/reinier-vegter">reinier-vegter</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-54818800-5");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
